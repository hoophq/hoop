name: Deploy Gateway
# on:
#   workflow_dispatch:

on:
  push:
    branches:
      - feat/continuous-deploy

jobs:
  deploy-gateway:
    # You need to use the INSTALLATION_NAME from the previous step
    runs-on: arc-runner-set
    steps:
    - name: Checkout
      uses: actions/checkout@v3
    - name: Assume Role
      uses: aws-actions/configure-aws-credentials@v4
      with:
        output-credentials: true
        aws-region: us-east-1
    - name: Get secrets by name and by ARN
      uses: aws-actions/aws-secretsmanager-get-secrets@v1
      with:
        parse-json-secrets: true
        secret-ids: |
          hoop/self-hosted/appdemo
    - run: helm version
    - run: kubectl version
    - run: |-
        ( echo "cat <<EOF" ; cat ./infra/appdemo/values.yml ; echo EOF ) | sh > ./appdemo-values.yml
    - run: grep CLIENT_ID ./appdemo-values.yml

